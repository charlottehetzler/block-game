{"version":3,"sources":["components/game/Scene.ts","components/game/Camera.ts","App.tsx","index.tsx","App.module.scss"],"names":["camera","scene","world","renderer","stack","overhangs","gameStarted","count","addLayer","x","z","width","depth","direction","layer","generateBox","y","length","falls","push","geometry","THREE","color","material","mesh","position","set","add","shape","CANNON","boxHeight","mass","body","addBody","threejs","cannonjs","animation","speed","topLayer","element","document","querySelector","innerHTML","toString","renderCount","step","forEach","copy","quaternion","render","startGame","previousLayer","delta","overhanging","Math","abs","size","overlap","newWidth","newDepth","scale","shapes","addShape","cutBox","overhangingShift","sign","overhang","addOverhanging","setAnimationLoop","window","removeEventListener","gameOverScreen","getElementById","style","display","gameOver","Scene","gravity","broadphase","solver","iterations","ambientLight","directionalLight","height","innerHeight","innerWidth","Camera","lookAt","antialias","alpha","setSize","rootElement","appendChild","domElement","addEventListener","e","code","console","log","App","useState","devEnabled","useEffect","id","styles","dev","app","className","onClick","location","reload","ReactDOM","StrictMode","module","exports"],"mappings":"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","file":"static/js/main.8c2c9aa5.chunk.js","sourcesContent":["import * as CANNON from \"cannon\";\nimport * as THREE from \"three\";\nimport { Camera } from \"./Camera\";\n\ntype LayerProps = {\n    x: number,\n    z: number,\n    width: number,\n    depth: number,\n    direction: string\n}\ntype OverhangProps = {\n    x: number,\n    z: number,\n    width: number,\n    depth: number\n}\ntype BoxProps = {\n    x: number,\n    y: number,\n    z: number,\n    width: number,\n    depth: number,\n    falls: boolean\n}\ntype CutProps = {\n\ttopLayer: any,\n\toverlap: any,\n\tsize: any,\n\tdelta: any\n}\n\nconst originalBoxSize = 3;\nconst boxHeight = 1;\nconst stack: any[] = [];\nconst overhangs: any[] = [];\nlet camera: THREE.Camera, scene: THREE.Scene, world: CANNON.World, renderer: THREE.WebGLRenderer;\nlet gameStarted = false;\nlet count = 0;\n\nfunction addLayer({x, z, width, depth, direction}: LayerProps) {\n\tconst y = boxHeight * stack.length;\n\n\tconst layer = generateBox({x, y, z, width, depth, falls: false});\n\tlayer.direction = direction;\n    \n\tstack.push(layer);\n}\n\nfunction addOverhanging({x, z, width, depth}: OverhangProps) {\n\tconst y = boxHeight * (stack.length - 1);\n\n\tconst overhang = generateBox({x, y, z, width, depth, falls: true});\n\toverhangs.push(overhang);\n}\n\nfunction generateBox({x, y, z, width, depth, falls}: BoxProps) {\n\tconst geometry = new THREE.BoxGeometry(width, boxHeight, depth);\n\n\tconst color = new THREE.Color(`hsl(${30 + stack.length * 4}, 100%, 50%)`);\n\tconst material = new THREE.MeshLambertMaterial({ color: color });\n\tconst mesh = new THREE.Mesh(geometry, material);\n\tmesh.position.set(x, y, z);\n\tscene.add(mesh);\n\n\tconst shape = new CANNON.Box(\n\t\tnew CANNON.Vec3(width / 2, boxHeight / 2, depth / 2)\n\t);\n\tconst mass = falls ? 5 : 0;\n\tconst body = new CANNON.Body({ mass, shape });\n\tbody.position.set(x, y, z);\n\tworld.addBody(body);\n\n\tconst direction = \"x\";\n\n\treturn {\n\t\tthreejs: mesh,\n\t\tcannonjs: body,\n\t\twidth,\n\t\tdepth,\n\t\tdirection\n\t};\n}\n\nfunction cutBox({topLayer, overlap, size, delta}: CutProps) {\n\tconst direction = topLayer.direction;\n\tconst newWidth = direction == \"x\" ? overlap : topLayer.width;\n\tconst newDepth = direction == \"z\" ? overlap : topLayer.depth;\n\n\ttopLayer.width = newWidth;\n\ttopLayer.depth = newDepth;\n\n\ttopLayer.threejs.scale[direction] = overlap / size;\n\ttopLayer.threejs.position[direction] -= delta / 2;\n\ttopLayer.cannonjs.position[direction] -= delta / 2;\n\n\tconst shape = new CANNON.Box(\n\t\tnew CANNON.Vec3(newWidth / 2, boxHeight / 2, newDepth / 2)\n\t);\n\ttopLayer.cannonjs.shapes = [];\n\ttopLayer.cannonjs.addShape(shape);\n\n\treturn {\n\t\tnewWidth: newWidth,\n\t\tnewDepth: newDepth\n\t};\n}\n\nfunction animation() {\n\tconst speed = 0.15;\n\tcount = stack.length - 1;\n\n\tconst topLayer = stack[stack.length - 1];\n\ttopLayer.threejs.position[topLayer.direction] += speed;\n\ttopLayer.cannonjs.position[topLayer.direction] += speed;\n\n\trenderCount();\n\n\tif (camera.position.y < boxHeight * (stack.length - 2) + 4) {\n\t\tcamera.position.y += speed;\n\t}\n\n\tupdatePhysics();\n\trenderer.render(scene, camera);\n}\n\nfunction updatePhysics() {\n\tworld.step(1 / 60);\n\n\toverhangs.forEach((element) => {\n\t\telement.threejs.position.copy(element.cannonjs.position);\n\t\telement.threejs.quaternion.copy(element.cannonjs.quaternion);\n\t});\n}\n\nfunction renderCount() {\n\tconst element = document.querySelector(\"#count\");\n\telement ? element.innerHTML = count.toString() : null;\n}\n\nfunction gameOver() {\n\trenderer.setAnimationLoop(null);\n\twindow.removeEventListener(\"click\", () => startGame());\n\n\tconst element = document.querySelector(\"#gm-count\");\n\telement ? element.innerHTML = count.toString() : null;\n\tconst gameOverScreen = document.getElementById(\"gameOverScreen\");\n\tif (gameOverScreen) {\n\t\tgameOverScreen.style ? gameOverScreen.style.display = \"flex\" : null;\n\t}\n}\n\nfunction startGame() {\n\tif(!gameStarted) {\n\t\trenderer.setAnimationLoop(animation);\n\t\tgameStarted = true;\n\t} else {\n\t\tconst topLayer = stack[stack.length - 1];\n\t\tconst previousLayer = stack[stack.length - 2];\n\t\tconst direction = topLayer.direction;\n\n\t\tconst delta = topLayer.threejs.position[direction] - previousLayer.threejs.position[direction];\n\t\tconst overhanging = Math.abs(delta);\n\t\tconst size = direction == \"x\" ? topLayer.width : topLayer.depth;\n\t\tconst overlap = size - overhanging;\n\n\t\tif (overlap > 0) {\n\t\t\tconst {newWidth, newDepth} = cutBox({topLayer, overlap, size, delta});\n\n\t\t\tconst overhangingShift = (overlap / 2 + overhanging / 2) * Math.sign(delta);\n\t\t\tconst overhangingX = direction == \"x\"\n\t\t\t\t? topLayer.threejs.position.x + overhangingShift\n\t\t\t\t: topLayer.threejs.position.x;\n\t\t\tconst overhangingZ = direction == \"z\"\n\t\t\t\t? topLayer.threejs.position.z + overhangingShift\n\t\t\t\t: topLayer.threejs.position.z;\n\t\t\tconst overhangWidth = direction == \"x\" ? overhanging : newWidth;\n\t\t\tconst overhangDepth = direction == \"z\" ? overhanging : newDepth;\n\n\t\t\taddOverhanging({ x: overhangingX, z: overhangingZ, width: overhangWidth, depth: overhangDepth });\n\n\t\t\tconst nextX = direction == \"x\" ? topLayer.threejs.position.x : -10;\n\t\t\tconst nextZ = direction == \"z\" ? topLayer.threejs.position.z : -10;\n\t\t\tconst nextDirection = direction == \"x\" ? \"z\" : \"x\";\n\n\t\t\taddLayer({ x: nextX, z: nextZ, width: newWidth, depth: newDepth, direction: nextDirection });\n\t\t} else {\n\t\t\tgameOver();\n\t\t}\n\t}\n}\n\nconst Scene = () => {\n\tworld = new CANNON.World();\n\tworld.gravity.set(0, -10, 0);\n\tworld.broadphase = new CANNON.NaiveBroadphase();\n\tworld.solver.iterations = 40;\n\n\tscene = new THREE.Scene();\n\n\taddLayer({ x: 0, z: 0, width: originalBoxSize, depth: originalBoxSize, direction: \"\" });\n\taddLayer({ x: -10, z: 0, width: originalBoxSize, depth: originalBoxSize, direction: \"x\" });\n\n\tconst ambientLight = new THREE.AmbientLight(0xffffff, .6);\n\tscene.add(ambientLight);\n\n\tconst directionalLight = new THREE.DirectionalLight(0xffffff, .6);\n\tdirectionalLight.position.set(10, 20, 0);\n\tscene.add(directionalLight);\n\n\tcamera = Camera();\n\tcamera.position.set(4, 4, 4);\n\tcamera.lookAt(0, 0, 0);\n\n\trenderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });\n\trenderer.setSize(window.innerWidth, window.innerHeight);\n\trenderer.render(scene, camera);\n    \n\tconst rootElement = document.getElementById(\"root\");\n\trootElement ? rootElement.appendChild(renderer.domElement) : null;\n\n\twindow.addEventListener(\"click\", () => startGame());\n\twindow.addEventListener(\"keyup\", (e) => {\n\t\tswitch (e.code) {\n\t\tcase \"Space\":\n\t\tcase \"Enter\":\n\t\t\tstartGame();\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tconsole.log(e.code);\n\t\t}\n\t});\n};\nexport default Scene;","import * as THREE from \"three\";\n\nexport const Camera = () => {\n\tconst width = 10;\n\tconst height = width + (window.innerHeight / window.innerWidth);\n\tconst near = 1;\n\tconst far = 100;\n\n\treturn new THREE.OrthographicCamera(\n\t\twidth / -2,\n\t\twidth / 2,\n\t\theight / 2,\n\t\theight / -2,\n\t\tnear,\n\t\tfar\n\t);\n};","import React, { useEffect, useState, FC } from \"react\";\nimport { FPSStats } from \"fps-react\";\n\nimport styles from \"./App.module.scss\";\nimport Scene from \"./components/game/Scene\";\n\nconst App: FC = () => {\n\tconst [devEnabled, setDevEnabled] = useState(false);\n\n\tuseEffect(() => {\n\t\tScene();\n\t}, []);\n\n\tfunction reloadPage() {\n\t\twindow.location.reload();\n\t}\n\n\treturn (\n\t\t<>\n\t\t\t{ devEnabled ? <div id={ styles.dev }>\n\t\t\t\t<FPSStats />\n\t\t\t</div> : null }\n\t\t\t<div id={ styles.app }>\n\t\t\t\t<div id=\"count\" className={ styles.count }>0</div>\n\t\t\t\t<div id=\"gameOverScreen\" className={ styles.gameOver }>\n\t\t\t\t\t<h1>Game Over!</h1>\n\t\t\t\t\t<h2>You reached <span id=\"gm-count\">0</span> Points!</h2>\n\t\t\t\t\t<button onClick={(e) => reloadPage()}>Try again!</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</>\n\t);\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./App\";\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById(\"root\")\n);","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"App_root__2CSG3\",\"app\":\"App_app__2ziFi\",\"count\":\"App_count__32WNx\",\"gameOver\":\"App_gameOver__3iCsK\"};"],"sourceRoot":""}